pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
frame = 0
anim  = 0
sz = 10
ai1 = {}
ai2 = {}

function _init()
cls()

for i=0,sz do
	ai1[i] = agent:new(
	rnd()*64,
	rnd()*128,
	8)
end
for i=0,sz do
	ai2[i] = agent:new(
	64+rnd()*64,
	rnd()*128,
	12)
end
end

function _update()
	for i=0,sz do
	for t=0,sz do
 	if t!=i then
  ai1[i]:flock(ai1[t])
  ai2[i]:flock(ai2[t])
  
  ai1[i]:fight(ai2[t])
  ai2[i]:fight(ai1[t])
  end
 end
 end
 
 for i=0,sz do
 	ai1[i]:update()
 	ai2[i]:update()
 end
 
 end

function _draw()
 cls()
 
 candy:display()
 
	for i=0,sz do
 ai1[i]:display()
 ai2[i]:display()
 end
 
end
-->8
-- agent
agent = {}
agent.loc = {}
agent.vel = {}
agent.acc = {}
agent.x = 0
agent.y = 0
agent.faction = 0

--stats
agent.sep_d = 0
agent.sep_m = 0

agent.ali_d = 0
agent.ali_m = 0

agent.coh_d = 0
agent.coh_m = 0

agent.force = 0

function agent:new(x,y,f)

	loc = vec:new(x,y)
	vel = vec:new(rnd()-0.5,rnd()-0.5)
	acc = vec:new(0,0)

	local inst = {}
 inst.loc = loc
 inst.vel = vel
 inst.acc = acc
 
 inst.sep_d = 5
 inst.sep_m = 4
 
 inst.ali_d = 10
 inst.ali_m = 0.2
 
 inst.coh_d = 25
 inst.coh_m = 0.1
 
 inst.frg_m = 10
 inst.force = 0.06

	inst.faction = f
	
	setmetatable(inst, self)
	self.__index = self
	
	return inst
	end

function agent:update(t)

	s = self
	f = s:forage()
	self.acc:add(f)
	
	s.acc:norm()
	s.acc:mult(self.force)
	s.vel:add(self.acc)

	s.vel:mult(0.99)
	s.loc:add(self.vel)
	
	if s.loc:dist(candy) < 4 then
	candy:spawn(s.faction)
	end
	
end

function agent:display()
	s = self
	circ(s.loc.x,
						s.loc.y,
						3,s.faction)
						
	s.acc:mult(100)
	--pset(s.loc.x+s.vel.x,
	--					s.loc.y+s.vel.y, 8)
	
	s.acc:set(0,0)
end

function agent:flock(t)

	d = self.loc:dist(t.loc)
	
	if d < self.sep_d then
 	v = self:sep(t.loc)
 	v:mult(self.sep_m)
 	self.acc:add(v)
 end
 if d < self.ali_d then
 	v = self:ali(t.vel)
 	v:mult(self.ali_m)
 	self.acc:add(v)
	end
	if  d < self.coh_d
	and d > self.sep_d then
 	v = self:coh(t.loc)
 	v:mult(self.coh_m)
 	self.acc:add(v)
	end
	
end

function agent:fight(t)
	d = self.loc:dist(t.loc)
	if d < 40 then
	v = self:sep(t.loc)
	v:mult(2)
	self.acc:add(v)
	end
	if d < 5 then
	self.vel:mult(0.9)
	self.acc:add(v)
	end
end

function agent:sep(t)
		v = vec:new(self.loc.x,self.loc.y)
		v:sub(t)
		v:norm()
		return(v)
end

function agent:ali(t)
		v = vec:new(t.x,t.y)
		v:norm()
		return(v)
end

function agent:coh(t)
		v = vec:new(t.x, t.y)
		v:sub(self.loc)
		v:norm()
		return(v)
end

function agent:forage()
		v = vec:new(candy.x, candy.y)
		v:sub(self.loc)
		v:norm()
		v:mult(self.frg_m)
		return(v)
end
-->8
-- veclib
vec = {}
vec_mt = {__index = vec}
vec.x = 0
vec.y = 0

function vec:new(x,y)
	local inst = {}
	inst.x = x
	inst.y = y
	setmetatable(inst, self)
	self.__index = self
	
	return inst
end

function vec:set(x,y)
	self.x = x
	self.y = y
end

function vec:copy()
	return(vec:new(self.x, self.y))
end

function vec:norm()
	if  (self.x != 0)
	and (self.y != 0) then
 	a = v.x^2
 	b = v.y^2
 	c = sqrt(a+b)
 	self:div(c)
	end
end

function vec:add(v)
 self.x+=v.x
 self.y+=v.y
end

function vec:dist(v)
	c = 0
	if  (self.x != 0)
	and (self.y != 0) then
	a = (self.x-v.x)^2
	b = (self.y-v.y)^2
	c = sqrt((a+b))
	end
	return c
end

function vec:sub(v)
	self.x-=v.x
	self.y-=v.y
end

function vec:mult(n)
	self.x *= n
 self.y *= n
end

function vec:div(n)
	self.x /= n
	self.y /= n
end
-->8
--candy!
candy = {}

candy.x = 64
candy.y = 64

f1 = 0
f2 = 0

function candy:display()
	circ(self.x, self.y, 8, 2)
	pset(self.x, self.y, 14)
	print(f1,0,0,8)
	print(f2,0,8,12)	
end

function candy:spawn(f)
	self.x = 32+rnd()*(128-64)
	self.y = 32+rnd()*(128-64)
	if f==8 then f1+=1 end
	if f==12 then f2+=1 end
end
__gfx__
00000000007777000077770000076000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007777770077777700006d000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770777777000777700007777000722227000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000077777707777777776700767007557000728827000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700077077077070770706d7007d6007557000728827000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700077777707777777700777700007777000722227000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007777770077777700006d000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007007000700007000076000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02222222222222222222222002222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02888888888888888888882002888820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822222222222222222282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822222222222222222282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02888888888888888888882002888820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02222222222222222222222002222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02222222222222222222222002222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02888888888888888888882002888820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822222222222222222282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822222222222222222282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822888888228888882282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822822228228222282282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822820028228200282282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822820028228200282282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822822228228222282282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822888888228888882282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822222222222222222282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822222222222222222282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822888888228888882282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822822228228222282282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822820028228200282282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822820028228200282282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822822228228222282282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822888888228888882282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822222222222222222282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02822222222222222222282002822820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02888888888888888888882002888820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02222222222222222222222002222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000076000000000000000000000000000000820000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000076000000000000000000000000000000820000000000000000000
00777700007777000077770000777700007777000077770000000000000000000000000000076000000000000000000000000000000820000000000000000000
00700767767007677670070000788788887887888878870000077777777777777777600000076000000888888888888888882000000820000000000000000000
007007d66d7007d66d70070000788722227887222278870000076666666766666667600000076000000822222228222222282000000820000000000000000000
00777700007777000077770000777700007777000077770000076000000760000007600000076000000820000008200000082000000820000000000000000000
0006d0000006d0000006d00000082000000820000008200000076000000760000007600000076000000820000008200000082000000820000000000000000000
00076000000760000007600000082000000820000008200000076000000760000007600000076000000820000008200000082000000820000000000000000000
00076000000760000007600000082000000820000008200000076000000760000007600000000000000820000008200000082000000000000000000000000000
0006d0000006d0000006d00000082000000820000008200000076000000760000007600000000000000820000008200000082000000000000000000000000000
00777700007777000077770000777700007777000077770000076000000760000007600000000000000820000008200000082000000000000000000000000000
00700767767007677670070000788788887887888878870000077777777777777777600077777777000888888888888888882000888888880000000000000000
007007d66d7007d66d70070000788722227887222278870000076666666766666667600066666666000822222228222222282000222222220000000000000000
00777700007777000077770000777700007777000077770000076000000760000007600000000000000820000008200000082000000000000000000000000000
0006d0000006d0000006d00000082000000820000008200000076000000760000007600000000000000820000008200000082000000000000000000000000000
00076000000760000007600000082000000820000008200000076000000760000007600000000000000820000008200000082000000000000000000000000000
00076000000760000007600000082000000820000008200000076000000760000007600000000000000820000008200000082000000000000000000000000000
0006d0000006d0000006d00000082000000820000008200000076000000760000007600000000000000820000008200000082000000000000000000000000000
00777700007777000077770000777700007777000077770000076000000760000007600000000000000820000008200000082000000000000000000000000000
00700767767007677670070000788788887887888878870000077777777777777777600000000000000888888888888888882000000000000000000000000000
007007d66d7007d66d70070000788722227887222278870000066666666666666666600000000000000222222222222222222000000000000000000000000000
00777700007777000077770000777700007777000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111100001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111000080888681998188111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11110000899092a6888989111100111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111189a69181a8a092111100111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111111119099a8909999a8000000111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111908886a1819988000000111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111111118990a886918192001111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111a6a199a8a6a1a8000000111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111132121212112111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111100001111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010100001b0501b0501b0501b0501b0501b0501b0501b0501b0501b0501b0501b05019050190501905019050190501b0501b0501b0501e0501e0501e0501b0501b0501b0501b050190501b050190501b0501b050
